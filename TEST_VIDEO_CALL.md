#!/bin/bash

# ðŸŽ¥ VIDEO CALL TESTING GUIDE - Local Laptop Testing
# How to test video consultation on single laptop

echo "=================================="
echo "ðŸŽ¥ VIDEO CALL LOCAL TESTING GUIDE"
echo "=================================="
echo ""

echo "ðŸ“‹ PREREQUISITES:"
echo "âœ“ Backend running on http://localhost:5001"
echo "âœ“ Frontend running on http://localhost:5173"
echo "âœ“ At least 1 confirmed video appointment in database"
echo ""

echo "=================================="
echo "STEP 1: Install Packages"
echo "=================================="
echo ""
echo "Backend packages:"
echo "  cd backend"
echo "  npm install agora-access-token"
echo ""
echo "Frontend packages:"
echo "  cd web-react-vite"
echo "  npm install agora-rtc-react agora-rtc-sdk-ng"
echo ""

echo "=================================="
echo "STEP 2: Start Servers"
echo "=================================="
echo ""
echo "Terminal 1 (Backend):"
echo "  cd backend"
echo "  npm run dev"
echo ""
echo "Terminal 2 (Frontend):"
echo "  cd web-react-vite"
echo "  npm run dev"
echo ""

echo "=================================="
echo "STEP 3: Test With Two Browser Windows"
echo "=================================="
echo ""
echo "Option A: Use Two Different Browsers"
echo "  Window 1: Chrome (Doctor)"
echo "    - Login as Doctor"
echo "    - Go to Appointments"
echo "    - Click 'Join' button"
echo ""
echo "  Window 2: Firefox/Safari (Patient)"
echo "    - Login as Patient"
echo "    - Go to Appointments"
echo "    - Click 'Join Consultation'"
echo ""

echo "Option B: Use Incognito/Private Mode"
echo "  Window 1: Normal Chrome (Doctor)"
echo "    - Login as Doctor"
echo "    - Join consultation"
echo ""
echo "  Window 2: Incognito Chrome (Patient)"
echo "    - Login as Patient"
echo "    - Join consultation"
echo ""

echo "=================================="
echo "STEP 4: Grant Permissions"
echo "=================================="
echo ""
echo "When prompted in each browser:"
echo "  âœ“ Allow Camera access"
echo "  âœ“ Allow Microphone access"
echo ""

echo "=================================="
echo "TESTING CHECKLIST"
echo "=================================="
echo ""
echo "â–¡ Can see your own video (local preview)"
echo "â–¡ Can see other person's video (remote)"
echo "â–¡ Can hear other person's audio"
echo "â–¡ Mute/Unmute button works"
echo "â–¡ Camera on/off button works"
echo "â–¡ End call button works"
echo ""

echo "=================================="
echo "QUICK TEST STEPS"
echo "=================================="
echo ""
echo "1. Open Chrome â†’ Login as Doctor â†’ /doctor/appointments"
echo "2. Open Firefox â†’ Login as Patient â†’ /patient/appointments"
echo "3. Both click 'Join' at same time"
echo "4. You should see both videos!"
echo ""

echo "=================================="
echo "TROUBLESHOOTING"
echo "=================================="
echo ""
echo "Issue: 'Join' button not showing"
echo "  - Check appointment status is 'confirmed'"
echo "  - Check consultationType is 'video'"
echo "  - Check paymentStatus is 'paid'"
echo "  - Check appointment time (within 15 min of start)"
echo ""
echo "Issue: Camera not working"
echo "  - Check browser permissions"
echo "  - Try different browser"
echo "  - Restart browser completely"
echo ""
echo "Issue: Can't see other person"
echo "  - Wait 5-10 seconds for connection"
echo "  - Check both users joined same appointment"
echo "  - Check network/firewall settings"
echo ""

echo "=================================="
echo "ðŸŽ‰ READY TO TEST!"
echo "=================================="
